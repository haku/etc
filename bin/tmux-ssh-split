#!/bin/sh
# source: https://github.com/pengwynn/dotfiles/blob/master/bin/tmux-ssh-split

#WINDOW_INDEX=$(tmux display-message -p '#I')
WINDOW_INDEX=$(tmux display-message -p '#D' | sed 's/%//')
SESSION_VARIABLE_NAME="window_${WINDOW_INDEX}_ssh_args"

SSH_ARGS=$(tmux showenv | grep -F "$SESSION_VARIABLE_NAME" | sed 's/^.*=//')
if [ -n "$SSH_ARGS" ] ; then
  # load full zsh env to get PATH and ssh agent.
  # then leave a local split.  this is an ugly hack.
  tmux splitw $1 "exec zsh -lc 'ssh $SSH_ARGS ; zsh'"
else
  tmux splitw $1
fi
