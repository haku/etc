#!/bin/bash
set -eu

irssi() {
  F="$HOME/.irssi/activity_file"
  if [ -s "$F" ] ; then
    echo -n '#[fg=blue]{#[fg=default] '
    for I in `cat $F`; do
      W=`echo $I | cut -d ',' -f 1`
      S=`echo $I | cut -d ',' -f 2`
      if [ "$S" != "0" ] ; then
        if [ "$S" = "1" ] ; then
          continue
          #A='#[fg=colour8]'
          #B=''
        elif [ "$S" = "2" ] ; then
          A='#[fg=yellow]'
          B=''
        elif [ "$S" = "3" ] ; then
          A='#[fg=white]>'
          B='<'
        else
          A=''
          B="@${S}"
        fi
        echo -n "${A}${W}${B}#[fg=default] "
      fi
    done 
    echo -n '#[fg=blue]}#[fg=default] '
  fi
}

network() {
  w="/usr/bin/wicd-cli"
  if [ -x "$w" ] && info=$("$w" --wireless -d) ; then
    ssid=$(echo "$info" | grep Essid | cut -d ' ' -f 2)
    qual=$(echo "$info" | grep Quality | cut -d ' ' -f 2)
    echo -n "${ssid}/${qual} "
  else
    ipaddr="$(ifconfig | sed -En 's/127.0.0.1//;s/.*inet (addr:)?(([0-9]*\.){3}[0-9]*).*/\2/p' | tr '\n' ',')"
    ipaddr="${ipaddr%,}"
    hostname="$(hostname)"
    echo -n "#[fg=green]$hostname/$ipaddr#[fg=default] "
  fi
}

batt() {
  b="$HOME/bin/battery"
  if [ -x "$b" ] ; then
    echo -n "$("$b") "
  fi
}

load() {
  echo -n "#[fg=brightblue]$(uptime | sed -e "s/^.*: //" -e "s/,//g")#[fg=default]"
}

irssi
network
batt
load
